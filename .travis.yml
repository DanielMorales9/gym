dist: trusty
sudo: false

language: java
jdk:
- openjdk8

services:
- docker

env:
  global:
# - DOCKER_DRIVER=overlay
# - DOCKER_HOST=tcp://docker:2375
  - TAG=0.0.1-SNAPSHOT
  - MAVEN_OPTS="-Dmaven.repo.local=.m2"

addons:
  apt:
    sources:
    - google-chrome
    packages:
    - google-chrome-stable

cache:
  directories:
  - ./ui/node_modules
  - ./ui/node
  - ./.m2/
before_cache:
- ls -la

test:
  - echo "fake test"

install:
  - mvn package -B
  - docker images
  - docker login -u AWS --password-stdin $AWS_REGISTRY_TOKEN https://$AWS_REGISTRY/
  - docker tag tenentedan9/ui:$TAG $AWS_REGISTRY/ui:$TAG
  - docker tag tenentedan9/gateway:$TAG $AWS_REGISTRY/gateway:$TAG
  - docker tag tenentedan9/api:$TAG $AWS_REGISTRY/api:$TAG
  - docker push $AWS_REGISTRY/ui:$TAG
  - docker push $AWS_REGISTRY/gateway:$TAG
  - docker push $AWS_REGISTRY/api:$TAG

notifications:
  email: false